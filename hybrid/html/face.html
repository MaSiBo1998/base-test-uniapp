<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script type="text/javascript" src="./js/uni.webview.1.5.2.js"></script>
        <script src="./js/jq.js" type="text/javascript" charset="utf-8"></script>
        <!-- uni 的 SDK -->
        <script type="text/javascript" src="https://js.cdn.aliyun.dcloud.net.cn/dev/uni-app/uni.webview.1.5.2.js">
        </script>
        <script src="https://cdn.bootcdn.net/ajax/libs/vConsole/3.0.0/vconsole.min.js" type="text/javascript"
            charset="utf-8"></script>
        <script>
            // init vConsole，app中查看
            var vConsole = new VConsole();
            console.log('Hello world');
        </script>
        <script>
            document.addEventListener('UniAppJSBridgeReady', function() {
                uni.webView.getEnv(function(res) {
                    console.log('当前环境：' + JSON.stringify(res));
                });
            });
        </script>
    </head>
    <body class='body'>

    </body>
    <script type="text/javascript">
        var video, canvas, vendorUrl, interval, videoHeight, videoWidth, time = 0;
        // 获取webview页面数据
        // var data = JSON.parse(getUrlParam('data'))
        // var info = data.info;
        // var userInfo = data.userInfo;
        // const userId = data.userId;	// 当前登录用户id
        // $("#userName").text(userInfo.realName);
        // $("#idcardno").text(userInfo.idcardNo);
        $(function() {
            // 初始化
            // initVideo()
            // uni.app事件
            document.addEventListener('UniAppJSBridgeReady', function() {});
            uni.webView.postMessage({
                data: {
                    method: 'getTitle',
                    value: 'test'
                }
            });
        })

        function dataURLtoBlob(dataurl) {
            var arr = dataurl.split(','),
                mime = arr[0].match(/:(.*?);/)[1],
                bstr = atob(arr[1]),
                n = bstr.length,
                u8arr = new Uint8Array(n);
            while (n--) {
                u8arr[n] = bstr.charCodeAt(n);
            }
            return new Blob([u8arr], {
                type: mime
            });
        }
        function dataURLtoFile(dataurl, filename) { 
            var arr = dataurl.split(','),
            mime = arr[0].match(/:(.*?);/)[1],
            bstr = atob(arr[1]),
            n = bstr.length,
            u8arr = new Uint8Array(n);
            while (n--) {
                u8arr[n] = bstr.charCodeAt(n);
            }
            return new File([u8arr], filename, { type: mime });
        }
        //将blob转换为file
        function blobToFile(theBlob, fileName) {
            theBlob.lastModifiedDate = new Date();
            theBlob.name = fileName;
            return theBlob;
        }

        // 获取url携带的数据
        function getFile(base64) {
            // uni.webView.postMessage({
            //     data: {
            //         method: 'getTitle',
            //         value: base64
            //     }
            // });
            // //调用
            var blob = dataURLtoBlob(base64);
            var file = blobToFile(blob, 'test');
            var file1 = dataURLtoFile(base64, 'test');
            console.log(file1)
            uni.webView.postMessage({
                data: {
                    method: 'getTitle',
                    value: file
                }
            });
            console.log(file)
        }
    </script>
</html>